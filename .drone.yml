---
{
   "kind": "pipeline",
   "name": "tidyall",
   "steps": [
      {
         "image": "plugins/docker",
         "name": "perl_tidyall_image",
         "settings": {
            "build_args": [
               "ALPINE_VERSION=3.17.0"
            ],
            "dockerfile": "perl-tidyall/Dockerfile",
            "label_schema": [
               "docker.dockerfile=perl-tidyall/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "perl-tidyall"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      }
   ],
   "trigger": {
      "branch": [
         "master"
      ],
      "event": [
         "push",
         "tag",
         "custom"
      ]
   },
   "type": "docker"
}
---
{
   "kind": "pipeline",
   "name": "default-amd64",
   "platform": {
      "arch": "amd64",
      "os": "linux"
   },
   "steps": [
      {
         "image": "plugins/docker",
         "name": "base_image",
         "settings": {
            "build_args": [
               "UBUNTU_VERSION=22.04"
            ],
            "dockerfile": "ubuntu-gcc/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-gcc/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-gcc-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "base_image"
         ],
         "image": "plugins/docker",
         "name": "build_image",
         "settings": {
            "dockerfile": "ubuntu-build/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-build/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-build-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "build_image"
         ],
         "image": "plugins/docker",
         "name": "test_image",
         "settings": {
            "dockerfile": "ubuntu-test/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-test/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-test-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "test_image"
         ],
         "image": "plugins/docker",
         "name": "func_test_image",
         "settings": {
            "dockerfile": "ubuntu-test-func/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-test-func/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-test-func-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "fedora_build_image",
         "settings": {
            "build_args": [
               "FEDORA_VERSION=38"
            ],
            "dockerfile": "fedora-build/Dockerfile",
            "label_schema": [
               "docker.dockerfile=fedora-build/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "fedora-build-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "fedora_build_image"
         ],
         "image": "plugins/docker",
         "name": "fedora_test_image",
         "settings": {
            "build_args": [
               "FEDORA_VERSION=38"
            ],
            "dockerfile": "fedora-test/Dockerfile",
            "label_schema": [
               "docker.dockerfile=fedora-test/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "fedora-test-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "centos8_pkg_image",
         "settings": {
            "dockerfile": "centos-8/Dockerfile",
            "label_schema": [
               "docker.dockerfile=centos-8/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "centos-8-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "centos9_pkg_image",
         "settings": {
            "dockerfile": "centos-9/Dockerfile",
            "label_schema": [
               "docker.dockerfile=centos-9/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "centos-9-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "centos7_pkg_image",
         "settings": {
            "dockerfile": "centos-7/Dockerfile",
            "label_schema": [
               "docker.dockerfile=centos-7/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "centos-7-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "ubuntu_jammy_pkg_image",
         "settings": {
            "dockerfile": "ubuntu-jammy/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-jammy/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "ubuntu-jammy-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "ubuntu_focal_pkg_image",
         "settings": {
            "dockerfile": "ubuntu-focal/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-focal/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "ubuntu-focal-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "debian_bullseye_pkg_image",
         "settings": {
            "dockerfile": "debian-bullseye/Dockerfile",
            "label_schema": [
               "docker.dockerfile=debian-bullseye/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "debian-bullseye-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "debian_bookworm_pkg_image",
         "settings": {
            "dockerfile": "debian-bookworm/Dockerfile",
            "label_schema": [
               "docker.dockerfile=debian-bookworm/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "debian-bookworm-amd64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      }
   ],
   "trigger": {
      "branch": [
         "master"
      ],
      "event": [
         "push",
         "tag",
         "custom"
      ]
   },
   "type": "docker"
}
---
{
   "kind": "pipeline",
   "name": "default-arm64",
   "platform": {
      "arch": "arm64",
      "os": "linux"
   },
   "steps": [
      {
         "image": "plugins/docker",
         "name": "base_image",
         "settings": {
            "build_args": [
               "UBUNTU_VERSION=22.04"
            ],
            "dockerfile": "ubuntu-gcc/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-gcc/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-gcc-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "base_image"
         ],
         "image": "plugins/docker",
         "name": "build_image",
         "settings": {
            "dockerfile": "ubuntu-build/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-build/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-build-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "build_image"
         ],
         "image": "plugins/docker",
         "name": "test_image",
         "settings": {
            "dockerfile": "ubuntu-test/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-test/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-test-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "test_image"
         ],
         "image": "plugins/docker",
         "name": "func_test_image",
         "settings": {
            "dockerfile": "ubuntu-test-func/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-test-func/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "ubuntu-test-func-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "fedora_build_image",
         "settings": {
            "build_args": [
               "FEDORA_VERSION=38"
            ],
            "dockerfile": "fedora-build/Dockerfile",
            "label_schema": [
               "docker.dockerfile=fedora-build/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "fedora-build-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "depends_on": [
            "fedora_build_image"
         ],
         "image": "plugins/docker",
         "name": "fedora_test_image",
         "settings": {
            "build_args": [
               "FEDORA_VERSION=38"
            ],
            "dockerfile": "fedora-test/Dockerfile",
            "label_schema": [
               "docker.dockerfile=fedora-test/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/ci",
            "tags": [
               "fedora-test-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "centos8_pkg_image",
         "settings": {
            "dockerfile": "centos-8/Dockerfile",
            "label_schema": [
               "docker.dockerfile=centos-8/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "centos-8-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "centos9_pkg_image",
         "settings": {
            "dockerfile": "centos-9/Dockerfile",
            "label_schema": [
               "docker.dockerfile=centos-9/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "centos-9-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "centos7_pkg_image",
         "settings": {
            "dockerfile": "centos-7/Dockerfile",
            "label_schema": [
               "docker.dockerfile=centos-7/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "centos-7-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "ubuntu_jammy_pkg_image",
         "settings": {
            "dockerfile": "ubuntu-jammy/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-jammy/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "ubuntu-jammy-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "ubuntu_focal_pkg_image",
         "settings": {
            "dockerfile": "ubuntu-focal/Dockerfile",
            "label_schema": [
               "docker.dockerfile=ubuntu-focal/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "ubuntu-focal-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "debian_bullseye_pkg_image",
         "settings": {
            "dockerfile": "debian-bullseye/Dockerfile",
            "label_schema": [
               "docker.dockerfile=debian-bullseye/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "debian-bullseye-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/docker",
         "name": "debian_bookworm_pkg_image",
         "settings": {
            "dockerfile": "debian-bookworm/Dockerfile",
            "label_schema": [
               "docker.dockerfile=debian-bookworm/Dockerfile"
            ],
            "password": {
               "from_secret": "docker_password"
            },
            "repo": "rspamd/pkg",
            "tags": [
               "debian-bookworm-arm64"
            ],
            "username": {
               "from_secret": "docker_username"
            }
         }
      }
   ],
   "trigger": {
      "branch": [
         "master"
      ],
      "event": [
         "push",
         "tag",
         "custom"
      ]
   },
   "type": "docker"
}
---
{
   "depends_on": [
      "default-amd64",
      "default-arm64"
   ],
   "kind": "pipeline",
   "name": "multiarchify",
   "steps": [
      {
         "image": "plugins/manifest",
         "name": "ci_ubuntu_gcc",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/ci:ubuntu-gcc",
            "template": "rspamd/ci:ubuntu-gcc-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "ci_ubuntu_build",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/ci:ubuntu-build",
            "template": "rspamd/ci:ubuntu-build-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "ci_ubuntu_test",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/ci:ubuntu-test",
            "template": "rspamd/ci:ubuntu-test-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "ci_ubuntu_test_func",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/ci:ubuntu-test-func",
            "template": "rspamd/ci:ubuntu-test-func-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "ci_fedora_build",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/ci:fedora-build",
            "template": "rspamd/ci:fedora-build-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "ci_fedora_test",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/ci:fedora-test",
            "template": "rspamd/ci:fedora-test-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "pkg_centos7",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/pkg:centos-7",
            "template": "rspamd/pkg:centos-7-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "pkg_centos8",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/pkg:centos-8",
            "template": "rspamd/pkg:centos-8-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "pkg_centos9",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/pkg:centos-9",
            "template": "rspamd/pkg:centos-9-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "pkg_ubuntu2004",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/pkg:ubuntu-focal",
            "template": "rspamd/pkg:ubuntu-focal-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "pkg_ubuntu2204",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/pkg:ubuntu-jammy",
            "template": "rspamd/pkg:ubuntu-jammy-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "pkg_debian11",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/pkg:debian-bullseye",
            "template": "rspamd/pkg:debian-bullseye-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      },
      {
         "image": "plugins/manifest",
         "name": "pkg_debian12",
         "settings": {
            "password": {
               "from_secret": "docker_password"
            },
            "platforms": [
               "linux/amd64",
               "linux/arm64"
            ],
            "target": "rspamd/pkg:debian-bookworm",
            "template": "rspamd/pkg:debian-bookworm-ARCH",
            "username": {
               "from_secret": "docker_username"
            }
         }
      }
   ],
   "type": "docker"
}
---
{
   "hmac": "0000000000000000000000000000000000000000000000000000000000000000",
   "kind": "signature"
}
...
